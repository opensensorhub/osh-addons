plugins {
    id "java"
    id "com.google.protobuf" version "0.9.4"
}

description = 'Meshtastic Driver'
ext.details = "Driver that utilizes a meshtastic Radio pre-configured with meshtastic Node Software to communicate with other meshtastic Radio"
version = '1.0.0'


dependencies {
    implementation 'org.sensorhub:sensorhub-core:' + oshCoreVersion
    implementation "com.google.protobuf:protobuf-java:3.25.1"
    testImplementation "junit:junit:4.13.1"
    testImplementation project(':sensorhub-comm-jssc')
}

protobuf {
    protoc {
        // Use protoc matching the runtime protobuf-java version
        artifact = "com.google.protobuf:protoc:3.25.1"
    }
    // Where to place generated sources
    generatedFilesBaseDir = "$projectDir/src/generated"

    // Configure generation tasks
    generateProtoTasks {
        all().each { task ->
            // enable java builtin (default) â€” leave plugin-free so we get plain java classes
            task.builtins {
                java {}
            }
            // ensure the proto source dir is considered an input (not strictly required, but explicit)
            task.inputs.dir("${projectDir}/src/main/protobufs")
        }
    }
}



// Make sure Gradle sees our non-standard proto source directory
sourceSets {
    main {
        // add the generated java to the java source set so IDEs/compilation pick them up
        java {
            srcDirs += "$projectDir/src/generated/main/java"
        }
        // tell the Java sourceSet where our proto files are; the plugin will read these
        proto {
            srcDirs = ['src/main/protobufs']
        }
    }
}

test {
    useJUnit()
}

// add info to OSGi manifest
osgi {
    manifest {
        attributes ('Bundle-Vendor': 'Botts Inc')
        attributes ('Bundle-Activator': 'com.sensorhub.impl.sensor.meshtastic.Activator')
    }
}

// add info to maven pom
ext.pom >>= {
    developers {
        developer {
            id 'BillBrown341'
            name 'Bill Brown'
            organization 'Botts Inc'
            organizationUrl ''
        }
    }
}
